@model ABCRetailers.Models.Customer
@{
	ViewData["Title"] = "Edit Customer";
}

<div class="row justify-content-center">
	<div class="col-md-8">
		<div class="card">
			<div class="card-header">
				<div class="d-flex justify-content-between align-items-center">
					<div>
						<h4><i class="fas fa-user-edit"></i> Edit Customer</h4>
						<p class="mb-0 text-muted">Update customer information</p>
					</div>
					<div>
						<span class="badge bg-primary">ID: @Model.CustomerId</span>
					</div>
				</div>
			</div>
			<div class="card-body">
				<form asp-action="Edit" method="post" id="editCustomerForm">
					<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

					<input type="hidden" asp-for="RowKey" />
					<input type="hidden" asp-for="PartitionKey" />
					<input type="hidden" asp-for="ETag" />
					<input type="hidden" asp-for="Timestamp" />

					<div class="mb-3">
						<label asp-for="CustomerId" class="form-label">
							<i class="fas fa-id-badge text-primary"></i> Customer ID
						</label>
						<input asp-for="CustomerId" class="form-control" readonly style="background-color: #f8f9fa;">
						<div class="form-text">
							<i class="fas fa-lock"></i> Customer ID cannot be changed after creation
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label asp-for="Name" class="form-label">
									<i class="fas fa-user text-success"></i> First Name
								</label>
								<input asp-for="Name" class="form-control" placeholder="Enter first name">
								<span asp-validation-for="Name" class="text-danger"></span>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label asp-for="Surname" class="form-label">
									<i class="fas fa-user text-success"></i> Last Name
								</label>
								<input asp-for="Surname" class="form-control" placeholder="Enter last name">
								<span asp-validation-for="Surname" class="text-danger"></span>
							</div>
						</div>
					</div>

					<div class="mb-3">
						<label asp-for="Username" class="form-label">
							<i class="fas fa-at text-info"></i> Username
						</label>
						<div class="input-group">
							<span class="input-group-text">@@</span>
							<input asp-for="Username" class="form-control" placeholder="Enter username">
						</div>
						<span asp-validation-for="Username" class="text-danger"></span>
						<div class="form-text">
							<i class="fas fa-info-circle"></i> Used for customer login and identification
						</div>
					</div>

					<div class="mb-3">
						<label asp-for="Email" class="form-label">
							<i class="fas fa-envelope text-warning"></i> Email Address
						</label>
						<input asp-for="Email" type="email" class="form-control" placeholder="Enter email address">
						<span asp-validation-for="Email" class="text-danger"></span>
						<div class="form-text">
							<i class="fas fa-info-circle"></i> Used for order confirmations and communication
						</div>
					</div>

					<div class="mb-4">
						<label asp-for="ShippingAddress" class="form-label">
							<i class="fas fa-map-marker-alt text-danger"></i> Shipping Address
						</label>
						<textarea asp-for="ShippingAddress" class="form-control" rows="3"
												   placeholder="Enter complete shipping address including street, city, state, and postal code"></textarea>
						<span asp-validation-for="ShippingAddress" class="text-danger"></span>
						<div class="form-text">
							<i class="fas fa-truck"></i> Default shipping address for orders
						</div>
					</div>

					<div class="d-flex justify-content-between">
						<a asp-action="Index" class="btn btn-secondary">
							<i class="fas fa-arrow-left"></i> Back to Customers
						</a>
						<div>
							<button type="button" class="btn btn-outline-secondary me-2" onclick="showResetConfirmation()">
								<i class="fas fa-undo"></i> Reset Changes
							</button>
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-save"></i> Update Customer
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>

		<div class="card mt-4">
			<div class="card-header">
				<h6><i class="fas fa-info-circle"></i> Customer Summary</h6>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6">
						<h6 class="text-primary">Account Details</h6>
						<ul class="list-unstyled">
							<li><strong>Customer ID:</strong> @Model.CustomerId</li>
							<li><strong>Full Name:</strong> @Model.Name @Model.Surname</li>
							<li><strong>Username:</strong> @Model.Username</li>
						</ul>
					</div>
					<div class="col-md-6">
						<h6 class="text-info">Contact Information</h6>
						<ul class="list-unstyled">
							<li><strong>Email:</strong> @Model.Email</li>
							<li><strong>Last Updated:</strong> @(Model.Timestamp?.ToString("MMM dd, yyyy HH:mm") ?? "Unknown")</li>
						</ul>
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-12">
						<h6 class="text-success">Shipping Address</h6>
						<p class="text-muted mb-0">@Model.ShippingAddress</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal for Reset Confirmation -->
<div class="modal fade" id="resetConfirmationModal" tabindex="-1" aria-labelledby="resetConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resetConfirmationModalLabel">Confirm Reset</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to reset all changes? This will restore the original values.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirmResetBtn">Reset Changes</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}

	<script>
		// Store original form values for reset functionality
		var originalValues = {};
        
        // This function is now responsible for showing the modal
		function showResetConfirmation() {
            var myModal = new bootstrap.Modal(document.getElementById('resetConfirmationModal'));
            myModal.show();
        }

		$(document).ready(function() {
			// Store original form values
			$('#editCustomerForm input, #editCustomerForm textarea').each(function() {
				originalValues[this.name] = $(this).val();
			});

			// Check for unsaved changes before leaving the page
			window.addEventListener('beforeunload', function(e) {
				var hasChanges = false;
				$('#editCustomerForm input, #editCustomerForm textarea').each(function() {
					if (originalValues[this.name] !== $(this).val()) {
						hasChanges = true;
						return false;
					}
				});

				if (hasChanges) {
					e.preventDefault();
					e.returnValue = '';
				}
			});

            // Handle the reset action when the modal's confirm button is clicked
            $('#confirmResetBtn').on('click', function() {
                // Restore original values
                for (var name in originalValues) {
                    $('[name="' + name + '"]').val(originalValues[name]);
                }

                // Clear validation messages
                $('.is-invalid').removeClass('is-invalid');
                $('.text-danger').text(''); // Clear validation spans

                // Hide the modal
                var myModal = bootstrap.Modal.getInstance(document.getElementById('resetConfirmationModal'));
                myModal.hide();
            });
		});
	</script>
}
